#!/opt/bin/perl5
#
# sync_tree.gnu
#
# $Revision: 1.2 $
# $Date: 2000/02/16 11:29:27 $
#
# This perl script is designed to create a tree of files
# suitable for jar'ing into a downloadable archive.  Only
# those files that the server needs are to be included.
#
# Jonathan Abbey 11 March 1998
#
#------------------------------------------------------------

$sourcedir = "<#CLASSDIR#>/gnu/regexp";
$targetdir = "<#CLASSDIR#>/server_classes/gnu/regexp";

# What directory are we handling?

chdir($targetdir);

# Clean it out

system("rm -rf *");

# We want to link in all classes from the gnu/regexp class directory

opendir SOURCEDIR, $sourcedir or die "couldn't open source dir";

# First get the list of normal (non-dir) files

@classes = grep -f, map "$sourcedir/$_", readdir SOURCEDIR;

# Now whittle off anything that's not a regular class file

@classes = grep /\.class$/, @classes;

closedir SOURCEDIR;

# And link em.

foreach $file (@classes) {

  # Peel off the sourcedir prefix to get the simple file name

  $file =~ /^$sourcedir\/(.*)/;
  $basename = $1;

  print "Linking " . $basename . "\n";

  $result = link ($file, $basename);
  
  if (!$result){
    print "$! -- $file\n";
  }
}

print "Done linking gnu classes.\n";
